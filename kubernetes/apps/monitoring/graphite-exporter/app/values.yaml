global:
  fullnameOverride: graphite-exporter

controllers:
  main:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      main:
        image:
          repository: docker.io/prom/graphite-exporter
          tag: v0.15.0
        command:
          [
            /bin/graphite_exporter,
            "--graphite.listen-address=:2003",
            --graphite.mapping-config=/config/graphite_mapping.yaml,
          ]
        env:
          TZ: America/Boise

probes:
  liveness:
    # -- Enable the liveness probe
    enabled: true
    # -- Set this to `true` if you wish to specify your own livenessProbe
    custom: true
    # -- sets the probe type when not using a custom probe
    # @default -- "TCP"
    type: TCP
    # -- The spec field contains the values for the default livenessProbe.
    # If you selected `custom: true`, this field holds the definition of the livenessProbe.
    # @default -- See below
    spec:
      failureThreshold: 3
      periodSeconds: 10
      successThreshold: 1
      tcpSocket:
        port: 2003
      timeoutSeconds: 1

persistence:
  config:
    enabled: true
    type: configMap
    name: graphite-exporter-configmap
    globalMounts:
      - path: /config
        readOnly: true

service:
  main:
    annotations:
      "io.cilium/lb-ipam-ips": "10.1.0.105"
    type: LoadBalancer
    externalTrafficPolicy: Local
    ports:
      http:
        enabled: false
      metrics:
        port: 9108
      graphite:
        port: 2003

serviceMonitor:
  main:
    enabled: true
    endpoints:
      - port: metrics
        scheme: http
        path: /metrics
        interval: 2m
        scrapeTimeout: 30s