global:
  fullnameOverride: graphite-exporter

controllers:
  main:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      main:
        image:
          repository: docker.io/prom/graphite-exporter
          tag: v0.15.0
        command:
          [
            /bin/graphite_exporter,
            "--graphite.listen-address=:2003",
            --graphite.mapping-config=/config/graphite_mapping.yaml,
          ]
        env:
          TZ: America/Boise


persistence:
  config:
    enabled: true
    type: configMap
    name: graphite-exporter-configmap
    globalMounts:
      - path: /config
        readOnly: true

service:
  main:
    annotations:
      "io.cilium/lb-ipam-ips": "10.1.0.105"
    type: LoadBalancer
    externalTrafficPolicy: Local
    ports:
      http:
        enabled: false
      graphite:
        port: 2003
  second:
    controller: main
    nameOverride: metrics
    ports:
      http:
        enabled: false
      metrics:
        port: 9108

serviceMonitor:
  main:
    enabled: true
    serviceName: graphite-exporter-metrics
    endpoints:
      - port: metrics
        scheme: http
        path: /metrics
        interval: 2m
        scrapeTimeout: 30s