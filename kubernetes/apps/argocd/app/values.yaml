configs:
  cm:
    url: "https://argocd.porkboi.io"
    exec.enabled: true
    admin.enabled: false
    kustomize.buildOptions: --enable-alpha-plugins --enable-exec
    oidc.config: |
        name: Authelia
        issuer: https://auth.porkboi.io
        clientID: argocd
        clientSecret: $oidc.authelia.clientSecret
        requestedScopes:
          - openid
          - profile
          - email
          - groups

  params:
    server.insecure: true

  rbac:
    policy.csv: |
      p, role:admin, exec, create, */*, allow
      g, lldap_admin, role:admin
    scopes: "[groups]"

  secret:
    createSecret: false

controller:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

dex:
  enabled: false

redis:
  exporter:
    enabled: true
  metrics:
    enabled: true
    service:
      clusterIP: ""
    serviceMonitor:
      enabled: true

server:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
  ingress:
    enabled: true
    annotations:
      external-dns.alpha.kubernetes.io/target: porkboi.io
      cert-manager.io/cluster-issuer: le-prod
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    ingressClassName: "nginx"
    hosts:
      - argocd.porkboi.com
    tls:
      - hosts:
          - argocd.porkboi.com
  ingressGrpc:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    ingressClassName: "nginx"
    hosts:
      - grpc.argocd.porkboi.io
    tls:
      - hosts:
          - grpc.argocd.porkboi.io
    https: false

repoServer:
  env:
    - name: XDG_CONFIG_HOME
      value: /.config
    - name: SOPS_AGE_KEY_FILE
      value: /.config/sops/age/key.txt

  initContainers:
    - name: install-ksops
      image: viaductoss/ksops:v4.3.0
      command: ["/bin/sh", "-c"]
      args:
      - 'echo "Installing KSOPS..."; mv /usr/local/bin/ksops /custom-tools/; mv /usr/local/bin/kustomize /custom-tools/; echo "Done.";'
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools

  volumeMounts:
    - mountPath: /usr/local/bin/kustomize
      name: custom-tools
      subPath: kustomize
    - mountPath: /.config/kustomize/plugin/viaduct.ai/v1/ksops/ksops
      name: custom-tools
      subPath: ksops
    - mountPath: /.config/sops/age
      name: sops-age

  volumes:
    - name: custom-tools
      emptyDir: {}
    - name: sops-age
      secret:
        secretName: sops-age
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

applicationSet:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

notifications:
  enabled: true
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true